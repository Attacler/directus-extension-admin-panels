import{useApi as e,useStores as t,definePanel as i}from"@directus/extensions-sdk";import{defineComponent as n,resolveComponent as a,openBlock as o,createElementBlock as s,normalizeClass as l,createVNode as d,withCtx as r,createTextVNode as c,toDisplayString as m,createBlock as p}from"vue";const u=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],h=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],f=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],b=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],g=(e,t,i)=>{let n=e;return"string"==typeof t||Array.isArray(t)?n=e.toLocaleString(t,i):!0!==t&&void 0===i||(n=e.toLocaleString(void 0,i)),n};var v=n({props:{showHeader:{type:Boolean,default:!1},text:{type:String,default:""}},data:()=>({files:[],collections:[],deleting:!1}),methods:{prettyBytes:e=>function(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);const i=(t={bits:!1,binary:!1,space:!0,...t}).bits?t.binary?b:f:t.binary?h:u,n=t.space?" ":"";if(t.signed&&0===e)return` 0${n}${i[0]}`;const a=e<0,o=a?"-":t.signed?"+":"";let s;if(a&&(e=-e),void 0!==t.minimumFractionDigits&&(s={minimumFractionDigits:t.minimumFractionDigits}),void 0!==t.maximumFractionDigits&&(s={maximumFractionDigits:t.maximumFractionDigits,...s}),e<1)return o+g(e,t.locale,s)+n+i[0];const l=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),i.length-1);return e/=(t.binary?1024:1e3)**l,s||(e=e.toPrecision(3)),o+g(Number(e),t.locale,s)+n+i[l]}(e),openFile(e){window.open("/admin/files/"+e,"_blank")},async deleteFile(e){if(this.deleting)return;this.deleting=!0,await this.api.delete("/files/"+e);const t=this.files.findIndex((t=>t.id==e));this.files.splice(t,1),this.deleting=!1}},async mounted(){this.api=e();const{useCollectionsStore:i}=t();this.collections=i().collections,this.files=(await this.api.get("/adminPanels/files")).data}});const y={key:0,class:"loading"};var x=[],w=[];function B(e,t){if(e&&"undefined"!=typeof document){var i,n=!0===t.prepend?"prepend":"append",a=!0===t.singleTag,o="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(a){var s=x.indexOf(o);-1===s&&(s=x.push(o)-1,w[s]={}),i=w[s]&&w[s][n]?w[s][n]:w[s][n]=l()}else i=l();65279===e.charCodeAt(0)&&(e=e.substring(1)),i.styleSheet?i.styleSheet.cssText+=e:i.appendChild(document.createTextNode(e))}function l(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var i=Object.keys(t.attributes),a=0;a<i.length;a++)e.setAttribute(i[a],t.attributes[i[a]]);var s="prepend"===n?"afterbegin":"beforeend";return o.insertAdjacentElement(s,e),e}}B("\n.admin-panel[data-v-96f513cc] {\n  overflow: auto;\n}\n.admin-panel.has-header[data-v-96f513cc] {\n  padding: 0 12px;\n}\n.open-in-new[data-v-96f513cc] {\n  padding-right: 5px;\n}\n.loading[data-v-96f513cc] {\n  cursor: not-allowed;\n  border: 2px solid transparent;\n  border-top: 2px solid var(--v-button-background-color);\n  border-radius: 50%;\n  width: 30px;\n  height: 30px;\n  animation: spin-96f513cc 2s linear infinite;\n  margin: 0 auto;\n  animation: spin-96f513cc 2s linear infinite;\n}\n@keyframes spin-96f513cc {\n0% {\n    transform: rotate(0deg);\n}\n100% {\n    transform: rotate(360deg);\n}\n}\n",{});B("\n.panel-container:has(.admin-panel) {\n  overflow: auto;\n}\n",{}),v.render=function(e,t,i,n,u,h){const f=a("v-icon"),b=a("v-button"),g=a("v-table");return o(),s("div",{class:l(["admin-panel",{"has-header":e.showHeader}])},[d(g,{headers:[{text:"Filename",value:"title",width:300,sortable:!0},{text:"Size",value:"filesize",width:175,sortable:!0}],items:e.files},{"item.filesize":r((({item:t})=>[c(m(e.prettyBytes(t.filesize)),1)])),"item-append":r((({item:t})=>[d(b,{icon:"",outlined:"",onClick:i=>e.openFile(t.id),class:"open-in-new"},{default:r((()=>[d(f,{name:"open_in_new"})])),_:2},1032,["onClick"]),d(b,{icon:"",outlined:"",onClick:i=>e.deleteFile(t.id)},{default:r((()=>[e.deleting?(o(),s("div",y)):(o(),p(f,{key:1,name:"delete"}))])),_:2},1032,["onClick"])])),_:2},1032,["items"])],2)},v.__scopeId="data-v-96f513cc",v.__file="panel-files/src/panel.vue";var k=i({id:"adminPanels-files",name:"Admin panels - view unlinked files",icon:"box",description:"Showcases all files that are not linked and allows you to easily delete them.",component:v,options:[],minWidth:30,minHeight:10}),_=n({props:{showHeader:{type:Boolean,default:!1},text:{type:String,default:""}},data:()=>({m2mItems:[],collections:[]}),methods:{async deleteItems(e,t){this.deleting||(this.deleting=!0,await this.api.delete("/items/"+e,{data:t}),console.log(e,t),this.deleting=!1)}},async mounted(){this.api=e();const{useCollectionsStore:i}=t();this.collections=i().collections,this.m2mItems=(await this.api.get("/adminPanels/m2m")).data}});B("\n.text[data-v-3ee0446a] {\n  padding: 12px;\n}\n.text.has-header[data-v-3ee0446a] {\n  padding: 0 12px;\n}\n",{}),_.render=function(e,t,i,n,p,u){const h=a("v-icon"),f=a("v-button"),b=a("v-table");return o(),s("div",{class:l(["text",{"has-header":e.showHeader}])},[d(b,{headers:[{text:"Collection",value:"collectionName",width:300},{text:"Amount of records",value:"size",width:175}],items:Object.keys(e.m2mItems).map((t=>({collection:t,collectionName:e.collections.find((e=>e.collection==t))?.name||"Unknown",ids:e.m2mItems[t]})))},{"item.size":r((({item:e})=>[c(m(e.ids.length),1)])),"item-append":r((({item:t})=>[d(f,{icon:"",outlined:"",onClick:i=>e.deleteItems(t.collection,t.ids)},{default:r((()=>[d(h,{name:"delete"})])),_:2},1032,["onClick"])])),_:2},1032,["items"])],2)},_.__scopeId="data-v-3ee0446a",_.__file="panel-m2m/src/panel.vue";const M=[],F=[],S=[],C=[],A=[k,i({id:"adminPanels-m2m",name:"Admin panels - empty M2M",icon:"box",description:"Showcases the empty M2M relations and allows you to easily delete them.",component:_,options:[],minWidth:24,minHeight:10})],E=[];export{F as displays,M as interfaces,S as layouts,C as modules,E as operations,A as panels};

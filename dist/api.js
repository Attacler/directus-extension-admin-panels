"use strict";function e(e,i,t){return null!=e.relations.find((e=>e.collection==i&&e.field==t))}const i=[{name:"endpoints",config:{id:"adminPanels",handler:(i,{services:t})=>{i.get("/m2m",(async(i,s)=>{const{accountability:n,schema:o}=i;if(1!=n.admin)return s.status(403),s.send("You don't have permission to access this.");const l=[],c=o.relations.filter((({collection:e})=>{if(-1!=l.indexOf(e))return!1;const i=o.relations.filter((i=>i.collection==e)).length>1;return 1==i&&l.push(e),i})).map((e=>e.collection));let r={};for(const i of c){const s=o.collections[i],n=Object.values(s.fields).filter((e=>e.field!=s.primary));if(n.filter((t=>!e(o,i,t.field))).length>0)continue;const l=n.filter((t=>e(o,i,t.field))).map((e=>e.field)),c=new t.ItemsService(i,{schema:o}),a=[];for(const e of l)a.push({[e]:{_null:!0}});const f=await c.readByQuery({filter:{_or:a},fields:[s.primary]});f.length>0&&(r[i]=f.map((e=>e[s.primary])))}s.json(r)})),i.get("/files",(async(e,i)=>{const{accountability:s,schema:n}=e;if(1!=s.admin)return i.status(403),i.send("You don't have permission to access this.");const o=n.relations.filter((e=>"directus_files"==e.related_collection)),l=new t.FilesService({schema:n}),c=await l.readByQuery({fields:["id","title","filesize"],limit:-1});for(const e of c)e.filesize=parseInt(e.filesize);const r={};for(const{collection:e,field:i}of o)null==r[e]&&(r[e]=[]),r[e].push(i);for(const e in r){const i=r[e],s=new t.ItemsService(e,{schema:n}),o=await s.readByQuery({fields:i,limit:-1});for(const e of o)for(const t of i)if(null!=e[t]){const i=c.findIndex((i=>i.id==e[t]));-1!=i&&c.splice(i,1)}}i.json(c)}))}}}];exports.endpoints=i,exports.hooks=[],exports.operations=[];
